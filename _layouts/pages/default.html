<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ site.title }}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Hanken+Grotesk:ital,wght@0,100..900;1,100..900&display=swap');
  </style>
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    // Check for saved theme preference
    const savedTheme = localStorage.getItem('viewMode');
    if (savedTheme === 'research') {
      document.documentElement.classList.add('research-theme');
    }
  </script>
  <style>
    /* Mobile Navigation Styles */
    .mobile-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 0.75rem 1rem;
      z-index: 1000;
    }

    @media (max-width: 768px) {
      .mobile-nav {
        display: block;
      }
      .desktop-top-nav {
        display: none;
      }
      .main-content-row {
        flex-direction: column;
      }
      body {
        padding-bottom: 4rem; /* Add space for mobile nav */
      }
    }

    @media (min-width: 769px) {
      body {
        margin: 0;
        padding: 2rem;
        min-height: 100vh;
      }
      .page-center-wrap {
        display: flex;
        justify-content: center;
        min-height: 100vh;
      }
      .page-container {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        max-width: 1600px;
        width: 100%;
        height: calc(100vh - 4rem);
      }
      .main-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        min-width: 0;
      }
      .works-panel {
        flex: 0 0 400px;
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        overflow-y: auto;
        display: block;
        transition: all 0.3s ease;
        opacity: 1;
        transform: translateX(0);
      }
      .works-panel.hide {
        display: none;
        opacity: 0;
        transform: translateX(20px);
      }
      
      /* Works panel specific styles */
      .works-panel .works-nav-container {
        position: sticky;
        top: 0;
        z-index: 100;
        background: white;
        padding: 0 0 1rem 0;
        margin-bottom: 1rem;
      }
      
      .works-panel .works-nav-buttons {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        justify-content: flex-start;
      }
      
      .works-panel .works-nav-button {
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        color: #4b5563;
        background: #f3f4f6;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .works-panel .works-nav-button:hover {
        background: #e5e7eb;
        color: #1f2937;
      }
      
      .works-panel .works-nav-button.active {
        background: #2563eb;
        color: white;
      }
      
      .works-panel .pub-item {
        display: block;
        width: 100%;
        margin-bottom: 16px;
        background: white;
        border-radius: 6px;
        overflow: hidden;
        box-sizing: border-box;
      }
      
      .works-panel .pub-image {
        width: 100%;
        height: 140px;
        background: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
        overflow: hidden;
      }
      
      .works-panel .pub-image img,
      .works-panel .placeholder-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      
      .works-panel .pub-content {
        padding: 12px 8px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .works-panel .pub-title {
        font-size: 14px;
        font-weight: 600;
        line-height: 1.2;
        text-decoration: none !important;
      }
      
      .works-panel .pub-meta {
        font-size: 12px;
        color: #666;
        line-height: 1.2;
        text-decoration: none !important;
      }
      
      .works-panel .placeholder-image {
        width: 100%;
        height: 140px;
        background: #f8f8f8;
        border-radius: 16px;
        display: block;
      }
      .desktop-top-nav {
        display: block;
        background: white;
        border-radius: 1rem;
        padding: 1rem 2rem;
        margin-bottom: 1rem;
      }
      .main-content-row {
        display: flex;
        flex: 1;
      }
      .container {
        width: 100%;
        max-width: 100%;
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        position: relative;
        display: flex;
        flex-direction: column;
        min-height: 0;
        overflow-y: auto;
      }
      .content {
        flex: 1;
        min-height: 0;
      }
    }
  </style>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
</head>
<body style="min-height:100vh;">
  <div class="page-center-wrap" style="display:flex;justify-content:center;min-height:100vh;width:100vw;">
    <div class="page-container">
      <div class="main-panel">
        <div class="main-content-row">
          <div class="container" id="main-container">
            <!-- Desktop Top Navigation -->
            <div class="desktop-top-nav">
              {% include components/navigation.html %}
            </div>
            
            <main class="content content-{{ page.id | default: page.title | replace: ' ', '-' | slice: 0, 5 }}" id="main-content">
              {{ content }}
            </main>
          </div>
        </div>
      </div>
      
      <!-- Works Panel (Desktop Only) -->
      <div class="works-panel" id="works-panel">
        <div class="works-nav-container">
          <div class="works-nav-buttons">
            <button class="works-nav-button active" data-filter="all">All</button>
            <button class="works-nav-button" data-filter="project">Projects</button>
            <button class="works-nav-button" data-filter="pub">Publications</button>
          </div>
        </div>
        
        <div class="pubs-list" style="margin:0 auto;">
          {% assign sorted_publications = site.data.pubs | sort: 'year' | reverse %}
          {% for pub in sorted_publications %}
            <div class="pub-item" data-type="pub">
              <a href="{{ pub.url | relative_url }}" class="pub-image-link">
                <div class="pub-image">
                  {% if pub.image %}
                  <img src="{{ '/assets/images/projects/' | append: pub.image | relative_url }}" alt="{{ pub.title }}">
                  {% else %}
                  <div class="placeholder-image"></div>
                  {% endif %}
                </div>
              </a>
              <a href="{{ pub.url | relative_url }}" class="pub-content">
                <div class="pub-header">
                  <div class="pub-meta">
                    {% assign author_list = pub.authors | split: ',' %}
                    {% assign first_author = author_list[0] | strip %}
                    {% if author_list.size > 1 %}
                      {{ first_author | split: ' ' | last }} et al.
                    {% else %}
                      {{ first_author | split: ' ' | last }}
                    {% endif %}
                    &nbsp;|&nbsp;{{ pub.venue_short }}, {{ pub.year }}
                  </div>
                </div>
              </a>
            </div>
          {% endfor %}
          {% assign sorted_projects = site.data.projects | sort: 'year' | reverse %}
          {% for project in sorted_projects %}
            <div class="pub-item" data-type="project">
              <a href="{{ project.url | relative_url }}" class="pub-image-link">
                <div class="pub-image">
                  {% if project.image %}
                  <img src="{{ '/assets/images/projects/' | append: project.image | relative_url }}" alt="{{ project.title }}">
                  {% else %}
                  <div class="placeholder-image"></div>
                  {% endif %}
                </div>
              </a>
              <a href="{{ project.url | relative_url }}" class="pub-content">
                <div class="pub-header">
                  <!-- Project title hidden as requested -->
                </div>
              </a>
            </div>
          {% endfor %}
          {% for pres in site.data.others.presentations %}
            <div class="pub-item" data-type="presentation">
              <a href="{{ pres.link | default: '#' }}" class="pub-image-link">
                <div class="pub-image">
                  {% if pres.image %}
                    <img src="{{ '/assets/images/projects/' | append: pres.image | relative_url }}" alt="{{ pres.title }}">
                  {% else %}
                    <div class="placeholder-image"></div>
                  {% endif %}
                </div>
              </a>
              <div class="pub-content">
                <div class="pub-header">
                  <div class="pub-title">{{ pres.title }}</div>
                  <div class="pub-meta">{{ pres.event }}{% if pres.date %}, {{ pres.date | date: '%b %Y' }}{% endif %}</div>
                  <div class="pub-meta">{{ pres.description }}</div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mobile Navigation -->
  <div class="mobile-nav">
    {% include components/navigation.html %}
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const worksPanel = document.getElementById('works-panel');
      const worksLinks = document.querySelectorAll('a[href*="/works"]');
      const homeLinks = document.querySelectorAll('a[href="/"]');
      let isWorksPanelOpen = true; // Start with panel open on home page

      // Check if we're on mobile
      function isMobile() {
        return window.innerWidth <= 768;
      }

      // Check if we're on the home page
      function isHomePage() {
        return window.location.pathname === '/' || window.location.pathname === '/index.html';
      }

      // Function to show works panel
      function showWorksPanel() {
        if (!isMobile()) {
          worksPanel.classList.remove('hide');
          isWorksPanelOpen = true;
        }
      }

      // Function to hide works panel
      function hideWorksPanel() {
        if (!isMobile()) {
          worksPanel.classList.add('hide');
          isWorksPanelOpen = false;
        }
      }

      // Initialize panel state based on current page
      if (isHomePage() && !isMobile()) {
        showWorksPanel();
      } else {
        hideWorksPanel();
      }

      // Add click handlers to works links
      worksLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          if (isMobile()) {
            // On mobile, allow normal navigation
            return;
          }
          e.preventDefault();
          showWorksPanel();
        });
      });

      // Add click handlers to home links
      homeLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          if (isMobile()) {
            // On mobile, allow normal navigation
            return;
          }
          e.preventDefault();
          showWorksPanel();
        });
      });

      // Handle navigation to other pages
      document.addEventListener('click', function(e) {
        const link = e.target.closest('a');
        if (link && !isMobile()) {
          const href = link.getAttribute('href');
          // If navigating to a page that's not home or works, hide the panel
          if (href && !href.includes('/works') && href !== '/' && !href.includes('index')) {
            hideWorksPanel();
          }
        }
      });

      // Handle back button
      window.addEventListener('popstate', function(e) {
        if (isHomePage() && !isMobile()) {
          showWorksPanel();
        } else {
          hideWorksPanel();
        }
      });

      // Handle window resize
      window.addEventListener('resize', function() {
        if (isMobile()) {
          hideWorksPanel();
        } else if (isHomePage()) {
          showWorksPanel();
        }
      });

      // Works panel filtering functionality
      const filterButtons = document.querySelectorAll('.works-panel .works-nav-button');
      const items = document.querySelectorAll('.works-panel .pub-item');

      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          const filter = this.getAttribute('data-filter');
          filterButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          items.forEach(item => {
            if (filter === 'all' || item.getAttribute('data-type') === filter) {
              item.style.display = 'block';
            } else {
              item.style.display = 'none';
            }
          });
        });
      });
    });
  </script>
</body>
</html>